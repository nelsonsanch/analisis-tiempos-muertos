rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // Función auxiliar para verificar autenticación
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // Colección principal de áreas (InterviewData)
    match /areas/{areaId} {
      // Permitir acceso completo a usuarios autenticados
      // NOTA: En esta versión, todos los usuarios autenticados pueden ver/editar todas las áreas
      // Para restringir por usuario, implementa un campo ownerId y valida: request.auth.uid == resource.data.ownerId
      allow read, write: if isAuthenticated();
    }
    
    // Colección de mediciones globales
    match /globalMeasurements/{measurementId} {
      allow read, write: if isAuthenticated();
    }
    
    // Colección de items globales de Tortuga (entradas/salidas compartidas)
    match /globalTurtleItems/{itemId} {
      allow read, write: if isAuthenticated();
    }
    
    // Colección legacy de análisis de tiempos (mantener compatibilidad)
    match /timeAnalysisAreas/{areaId} {
      allow read, write: if isAuthenticated();
    }
    
    // Colección de usuarios autorizados
    match /authorized_users/{userId} {
      allow read: if isAuthenticated();
      allow write: if isAuthenticated() && request.auth.uid == userId;
    }
    
    // IMPORTANTE: Denegar acceso a cualquier otra colección no especificada
    // Esto protege contra accesos no autorizados a colecciones futuras
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
